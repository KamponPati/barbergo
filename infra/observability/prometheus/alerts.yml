groups:
  - name: barbergo-slo
    rules:
      - alert: BarberGoApiDown
        expr: up{job="barbergo-api"} == 0
        for: 2m
        labels:
          severity: critical
          service: barbergo-api
        annotations:
          summary: "BarberGo API target is down"
          description: "Prometheus cannot scrape barbergo-api for >2 minutes."

      - alert: BarberGoHigh5xxRate
        expr: rate(barbergo_errors_total[5m]) / clamp_min(rate(barbergo_requests_total[5m]), 0.001) > 0.05
        for: 10m
        labels:
          severity: warning
          service: barbergo-api
        annotations:
          summary: "High API 5xx ratio"
          description: "5xx/request ratio is above 5% for 10 minutes."

      - alert: BarberGoHighLatency
        expr: barbergo_http_request_duration_ms_avg > 800
        for: 10m
        labels:
          severity: warning
          service: barbergo-api
        annotations:
          summary: "High API latency"
          description: "Average request duration is above 800ms for 10 minutes."

      - alert: BarberGoLowTraffic
        expr: rate(barbergo_requests_total[15m]) < 0.005
        for: 30m
        labels:
          severity: info
          service: barbergo-api
        annotations:
          summary: "Low API traffic"
          description: "Request rate is below expected baseline for 30 minutes."

